{часовые срезы}
/*ReportName="Показатели экономичности (эком)" (срезы на конец часа)*/
/*Mode=часовые-1*/
/*DownQuery="часовые срезы по сменам 8/12"*/
/*UpQuery="суточные срезы"*/

SET QUOTED_IDENTIFIER OFF
SELECT
	DateAdd(mi, -5, DateTime) as "Дата",
	null,
	CAST((L01_EB10P000_H1+L02_EB10P000_H1)/1000 as decimal(15,3))
		as "Выработка<br>эл/эн,<br>тыс.кВт.ч. [(L01_EB10P000_H1+L02_EB10P000_H1)]",
	CAST(((L01_EB10P000_H1+L02_EB10P000_H1)-(L07_EB10P000_H1+L08_EB10P000_H1+L09_EB10P000_H1+L67_EB10P000_H1+L20_EB10P000_H1+L21_EB10P000_H1+L22_EB10P000_H1+L23_EB10P000_H1))/1000 as decimal(15,3))
		as "Отпуск<br>эл/эн,<br>тыс.кВт.ч. [E01-(E19+E20+E21+E22+E23+E24+E25+E26)]",
	CAST((U04_UM11W001_H1 - U04_UM21W001_H1 + U05_UM31W001_H1 + ISNULL(U08_UM31W001_H1, 0) + U07_UM31W001_H1 + U06_UM31W001_H1) / 4.183 + (ISNULL(U01_UN31W001_H1, 0) + U02_UN31W001_H1 + U03_UN31W001_H1) / 4.187 as decimal(15,2))
		as "Отпуск<br>т/эн,<br>ГКал [Отпуск теплоэнергии, ГКал]",
	CAST(((ISNULL(U01_UN31W001_H1, 0)+U02_UN31W001_H1+U03_UN31W001_H1)/4.187) + ((U04_UM11W002_H1+U06_UM11W002_H1+U07_UM11W002_H1+U05_UM11W002_H1+ISNULL(U08_UM11W002_H1, 0))-(U04_UM21W002_H1+U06_UM21W002_H1+U06_UM22W002_H1+U07_UM21W002_H1+U05_UM21W002_H1+ISNULL(U08_UM21W002_H1, 0))) as decimal(15,2))
		as "корр Отпуск т/эн,<br>ГКал [Отпуск теплоэнергии, ГКал]",
	CAST(((U04_UM11W001_H1 - U04_UM21W001_H1)+U05_UM31W001_H1+ISNULL(U08_UM31W001_H1, 0)+U07_UM31W001_H1+U06_UM31W001_H1) / 4.183 as decimal(15, 2))
		as "Отпуск т/эн<br>водой,<br>ГКал [Отпуск теплоэнергии по магистралям Центр+Док+запад+ВЗРД]",
	CAST(((U04_UM11W002_H1+U06_UM11W002_H1+U07_UM11W002_H1+U05_UM11W002_H1+ISNULL(U08_UM11W002_H1, 0))-(U04_UM21W002_H1+U06_UM21W002_H1+U06_UM22W002_H1+U07_UM21W002_H1+U05_UM21W002_H1+ISNULL(U08_UM21W002_H1, 0))) as decimal(15,2))
		as "корр Отпуск<br>т/эн_водой,<br>ГКал [Отпуск теплоэнергии по магистралям Центр+Док+запад+ВЗРД]",
	CAST((ISNULL(U01_UN31W001_H1, 0)+U02_UN31W001_H1+U03_UN31W001_H1)/4.187 as decimal(15,2))
		as "Отпуск т/эн<br>паром,<br>ГКал [Отпуск теплоэнергии по магистралям Док+КИМ+ВЗРД (пар)]",
	CAST(G01_AM31Q701_H1_korr/1000 as decimal(15,3))
		as "Расход газа,<br>тыс. м3/ч [G01_AM31Q701_H1]",
	CAST(G01_AM31Q701_H1_korr*G00_AF00W102/7/1000 as decimal(15,3))
		as "Расход<br>усл._топл,<br>ТУТ [G01_AM31Q701_H1*G00_AF00W102/7]",
	CAST(MI_URT_OE as decimal(15,3))
		as "Уд. расх.<br>топл. [MI_URT_OE]",
	CAST((MI_URT_OE*((L01_EB10P000_H1+L02_EB10P000_H1)-(L07_EB10P000_H1+L08_EB10P000_H1+L09_EB10P000_H1+L67_EB10P000_H1+L20_EB10P000_H1+L21_EB10P000_H1+L22_EB10P000_H1+L23_EB10P000_H1))/1000)/1000 as decimal(15,2))
		as "Расх. топл.<br>на_отп._ЭЭ,<br>ТУТ [Расход топлива на отпуск электроэнергии]",
	CAST(G01_AM31Q701_H1_korr*G00_AF00W102/7/1000-MI_URT_OE*((L01_EB10P000_H1+L02_EB10P000_H1)-(L07_EB10P000_H1+L08_EB10P000_H1+L09_EB10P000_H1+L67_EB10P000_H1+L20_EB10P000_H1+L21_EB10P000_H1+L22_EB10P000_H1+L23_EB10P000_H1))/1000*0.001 as decimal(15,2))
		as "Расх. топл.<br>на_отп._ТЭ,<br>ТУТ [Расход топлива на отпуск теплоэнергии]",
	cast(((G01_AM31Q701_H1_korr * G00_AF00W102 / 7 / 1000 - MI_URT_OE * ((L01_EB10P000_H1 + L02_EB10P000_H1) - (L07_EB10P000_H1 + L08_EB10P000_H1 + L09_EB10P000_H1 + L67_EB10P000_H1 + L20_EB10P000_H1 + L21_EB10P000_H1 + L22_EB10P000_H1 + L23_EB10P000_H1)) / 1000 * 0.001)* 1000/(ISNULL(NULLIF(((U04_UM11W001_H1 - U04_UM21W001_H1 + U05_UM31W001_H1 + ISNULL(U08_UM31W001_H1, 0) + U07_UM31W001_H1 + U06_UM31W001_H1) / 4.183 + (ISNULL(U01_UN31W001_H1, 0) + U02_UN31W001_H1 + U03_UN31W001_H1) / 4.187), 0), 1))) as decimal(15, 2))
		as "Уд. расх. топл.<br>на_отп._ТЭ,<br>кг/ГКал [Удельный Расход топлива на отпуск теплоэнергии при заданом Вээ, кг/ГКал]",
	CAST(dbo.vst_SafeDIV((G01_AM31Q701_H1_korr*G00_AF00W102/7/1000-MI_URT_OE*((L01_EB10P000_H1+L02_EB10P000_H1)-(L07_EB10P000_H1+L08_EB10P000_H1+L09_EB10P000_H1+L67_EB10P000_H1+L20_EB10P000_H1+L21_EB10P000_H1+L22_EB10P000_H1+L23_EB10P000_H1))/1000*0.001), ((ISNULL(U01_UN31W001_H1, 0)+U02_UN31W001_H1+U03_UN31W001_H1)/4.187) + ((U04_UM11W002_H1+U06_UM11W002_H1+U07_UM11W002_H1+U05_UM11W002_H1+ISNULL(U08_UM11W002_H1, 0))-(U04_UM21W002_H1+U06_UM21W002_H1+U06_UM22W002_H1+U07_UM21W002_H1+U05_UM21W002_H1+ISNULL(U08_UM21W002_H1, 0))))*1000 as decimal(15, 2))
		as "корр Уд. расх.<br>топл._на_отп._ТЭ,<br>кг/ГКал [Удельный Расход топлива на отпуск теплоэнергии при заданом Вээ, кг/ГКал]",
	cast(100 *((0.86 * (((L01_EB10P000_H1 + L02_EB10P000_H1) - (L07_EB10P000_H1 + L08_EB10P000_H1 + L09_EB10P000_H1 + L67_EB10P000_H1 + L20_EB10P000_H1 + L21_EB10P000_H1 + L22_EB10P000_H1 + L23_EB10P000_H1)) / 1000)+ ((U04_UM11W001_H1 - U04_UM21W001_H1 + U05_UM31W001_H1 + ISNULL(U08_UM31W001_H1, 0) + U07_UM31W001_H1 + U06_UM31W001_H1) / 4.183 + (ISNULL(U01_UN31W001_H1, 0) + U02_UN31W001_H1 + U03_UN31W001_H1) / 4.187))/ (ISNULL(NULLIF(dbo.Zero((isnull(G01_AM31Q701_H1_korr,0) * isnull(G00_AF00W102,0) / 7 / 1000 * 7)), 0), 1)) ) as decimal(15, 2))
		as "КПД топливо<br>использования,<br>% [КПД топливоиспользования ТЭЦ, %]",
	CAST(100*dbo.vst_SafeDIV((0.86*((L01_EB10P000_H1+L02_EB10P000_H1)-(L07_EB10P000_H1+L08_EB10P000_H1+L09_EB10P000_H1+L67_EB10P000_H1+L20_EB10P000_H1+L21_EB10P000_H1+L22_EB10P000_H1+L23_EB10P000_H1))/1000+((ISNULL(U01_UN31W001_H1, 0)+U02_UN31W001_H1+U03_UN31W001_H1)/4.187) + ((U04_UM11W002_H1+U06_UM11W002_H1+U07_UM11W002_H1+U05_UM11W002_H1+ISNULL(U08_UM11W002_H1, 0))-(U04_UM21W002_H1+U06_UM21W002_H1+U06_UM22W002_H1+U07_UM21W002_H1+U05_UM21W002_H1+ISNULL(U08_UM21W002_H1, 0)))),(G01_AM31Q701_H1_korr*G00_AF00W102/7/1000*7)) as decimal(15,2))
		as "корр<br>КПД_ТИ,<br>% [КПД топливоиспользования ТЭЦ, %]"
FROM (
	SELECT *,
		CASE WHEN DateTime >= '20211008 15:49:00' AND DateTime <= '20211026 10:00:00' THEN G01_AM31Q701_H1 / 1000 ELSE G01_AM31Q701_H1 END AS G01_AM31Q701_H1_korr
	FROM 
		OpenQuery(INSQL,
		"SELECT DateTime, CLC_ShiftDuty,
		U04_UM11W002_H1, U06_UM11W002_H1, U07_UM11W002_H1, U05_UM11W002_H1, U04_UM21W002_H1, U06_UM21W002_H1, U06_UM22W002_H1, U07_UM21W002_H1, U05_UM21W002_H1,
		L01_EB10P000_H1, L02_EB10P000_H1, L07_EB10P000_H1, L08_EB10P000_H1, L09_EB10P000_H1, L67_EB10P000_H1, L20_EB10P000_H1, L21_EB10P000_H1, L22_EB10P000_H1, 
		U04_UM11W001_H1, U04_UM21W001_H1, U08_UM31W001_H1, U08_UM21W002_H1, U08_UM11W002_H1,
		L23_EB10P000_H1, MI_URT_OE, U04_UM31W001_H1, U06_UM31W001_H1, U07_UM31W001_H1, U05_UM31W001_H1, U01_UN31W001_H1, U02_UN31W001_H1, U03_UN31W001_H1,
		G01_AM31Q701_H1, G00_AF00W102
		FROM Runtime.dbo.AnalogWideHistory
		WHERE wwVersion = 'Latest'
		AND wwRetrievalMode = 'Cyclic'
		AND wwResolution = @resolution
		AND DateTime >= @start
		AND DateTime <= @finish")
) AS T1


{суточные срезы}
/*ReportName="Показатели экономичности (эком)" (срезы на конец суток)*/
/*Mode=суточные-1*/
/*DownQuery="часовые срезы"*/
/*UpQuery="смены за месяц"*/

SET QUOTED_IDENTIFIER OFF
SELECT 
	DateAdd(mi, -1445, DateTime) as "Дата",
	null,
	CAST((L01_EB10P000_S1+L02_EB10P000_S1)/1000 as decimal(15,3))
		as "Выработка Эл/эн, тыс.кВт.ч. [(L01_EB10P000_S1+L02_EB10P000_S1)]",
	CAST(((L01_EB10P000_S1+L02_EB10P000_S1)-(L07_EB10P000_S1+L08_EB10P000_S1+L09_EB10P000_S1+L67_EB10P000_S1+L20_EB10P000_S1+L21_EB10P000_S1+L22_EB10P000_S1+L23_EB10P000_S1))/1000 as decimal(15,3))
		as "Отпуск Эл/эн, тыс.кВт.ч. [E01-(E19+E20+E21+E22+E23+E24+E25+E26)]",
	CAST((U04_UM31W001_S1+U06_UM31W001_S1+U07_UM31W001_S1+U05_UM31W001_S1+ISNULL(U08_UM31W001_S1, 0)+ISNULL(U01_UN31W001_S1, 0)+U02_UN31W001_S1+U03_UN31W001_S1)/4.187 as decimal(15,2))
		as "Отпуск т/эн, ГКал [Отпуск теплоэнергии, ГКал]",
	CAST((U04_UM31W001_S1+U06_UM31W001_S1+U07_UM31W001_S1+U05_UM31W001_S1+ISNULL(U08_UM31W001_S1, 0))/4.187 as decimal(15,2))
		as "Отпуск т/эн водой, ГКал [Отпуск теплоэнергии по магистралям Центр+Док+запад+ВЗРД]",
	CAST((ISNULL(U01_UN31W001_S1, 0)+U02_UN31W001_S1+U03_UN31W001_S1)/4.187 as decimal(15,2))
		as "Отпуск т/эн паром, ГКал [Отпуск теплоэнергии по магистралям Док+КИМ+ВЗРД (пар)]",
	CAST((G01_AM11Q001_S1_korr) as decimal(15,3))
		as "Расход газа, тыс. м3/ч [(G01_AM11Q701_S1)]",
	CAST((G01_AM11Q001_S1_korr)*G00_AF00W102/7 as decimal(15,3))
		as "Расход Усл. Топл,  ТУТ [(G01_AM11Q701_S1)*G00_AF00W102/7]",
	CAST(MI_URT_OE as decimal(15,3))
		as "Уд. расх. топл. [MI_URT_OE]",
	CAST((MI_URT_OE*((L01_EB10P000_S1+L02_EB10P000_S1)-(L07_EB10P000_S1+L08_EB10P000_S1+L09_EB10P000_S1+L67_EB10P000_S1+L20_EB10P000_S1+L21_EB10P000_S1+L22_EB10P000_S1+L23_EB10P000_S1))/1000)/1000 as decimal(15,2))
		as "Расх. топл. на отп. ЭЭ, ТУТ [Расход топлива на отпуск электроэнергии]",
	CAST((isnull(G01_AM11Q701_S1,0))*isnull(G00_AF00W102,0)/7/1000-MI_URT_OE*((isnull(L01_EB10P000_S1,0)+isnull(L02_EB10P000_S1,0))-(isnull(L07_EB10P000_S1,0)+isnull(L08_EB10P000_S1,0)+isnull(L09_EB10P000_S1,0)+isnull(L67_EB10P000_S1,0)+isnull(L20_EB10P000_S1,0)+isnull(L21_EB10P000_S1,0)+isnull(L22_EB10P000_S1,0)+isnull(L23_EB10P000_S1,0)))/1000*0.001 as decimal(15,2))
		as "Расх. топл. на отп. ТЭ, ТУТ [Расход топлива на отпуск теплоэнергии]",
	CAST(dbo.vst_SafeDIV(((isnull(G01_AM11Q701_S1,0))*isnull(G00_AF00W102,0)/7/1000-MI_URT_OE*((isnull(L01_EB10P000_S1,0)+isnull(L02_EB10P000_S1,0))-(isnull(L07_EB10P000_S1,0)+isnull(L08_EB10P000_S1,0)+isnull(L09_EB10P000_S1,0)+isnull(L67_EB10P000_S1,0)+isnull(L20_EB10P000_S1,0)+isnull(L21_EB10P000_S1,0)+isnull(L22_EB10P000_S1,0)+isnull(L23_EB10P000_S1,0)))/1000*0.001),((isnull(U04_UM31W001_S1,0)+isnull(U06_UM31W001_S1,0)+isnull(U07_UM31W001_S1,0)+isnull(U05_UM31W001_S1,0)+isnull(ISNULL(U08_UM31W001_S1, 0),0)+isnull(U01_UN31W001_S1,0)+isnull(U02_UN31W001_S1,0)+isnull(U03_UN31W001_S1,0)))/4.187)*1000 as decimal(15,3))
		as "Уд. расх. топл. на отп. ТЭ, кг/ГКал [Удельный Расход топлива на отпуск теплоэнергии при заданом Вээ, кг/ГКал]",
	CAST(100 * dbo.vst_SafeDIV((0.86 * ((isnull(L01_EB10P000_S1, 0) + isnull(L02_EB10P000_S1, 0)) - (isnull(L07_EB10P000_S1, 0) + isnull(L08_EB10P000_S1, 0) + isnull(L09_EB10P000_S1, 0) + isnull(L67_EB10P000_S1, 0) + isnull(L20_EB10P000_S1, 0) + isnull(L21_EB10P000_S1, 0) + isnull(L22_EB10P000_S1, 0) + isnull(L23_EB10P000_S1, 0))) / 1000 + (isnull(U04_UM31W001_S1, 0) + isnull(U06_UM31W001_S1, 0) + isnull(U07_UM31W001_S1, 0) + isnull(U05_UM31W001_S1, 0) + isnull(ISNULL(U08_UM31W001_S1, 0), 0) + isnull(U01_UN31W001_S1, 0) + isnull(U02_UN31W001_S1, 0) + isnull(U03_UN31W001_S1, 0)) / 4.187), (isnull(G01_AM11Q701_S1, 0) * isnull(G00_AF00W102, 0) / 1000)) as decimal(25, 2))
		as "КПД топливо- использования, % [КПД топливоиспользования ТЭЦ, %]"
FROM (
	SELECT *,
		CASE WHEN DateTime >= '20211008 15:49:00' THEN G01_AM11Q001_S1 / 1000 ELSE G01_AM11Q001_S1 END AS G01_AM11Q001_S1_korr
	FROM
		OpenQuery(INSQL,
		"SELECT DateTime, CLC_ShiftDuty,
		U08_UM31W001_S1, G01_AM11Q001_S1,
		L01_EB10P000_S1, L02_EB10P000_S1, L07_EB10P000_S1, L08_EB10P000_S1, L09_EB10P000_S1, L67_EB10P000_S1, L20_EB10P000_S1, L21_EB10P000_S1,
		L22_EB10P000_S1, L23_EB10P000_S1, MI_URT_OE, U04_UM31W001_S1, U06_UM31W001_S1, U07_UM31W001_S1, U05_UM31W001_S1, U01_UN31W001_S1,
		U02_UN31W001_S1, U03_UN31W001_S1, G01_AM11Q701_S1, G01_AM12Q701_S1, G00_AF00W102
		FROM Runtime.dbo.AnalogWideHistory
		WHERE wwVersion = 'Latest'
		AND wwRetrievalMode = 'Cyclic'
		AND wwResolution = @resolution
		AND DateTime >= @start
		AND DateTime <= @finish")
) AS T1


{часовые срезы по сменам 8/12}
/*ReportName="Показатели экономичности (эком)" (часовые срезы по сменам 8/12)*/
/*Mode=8-12*/
/*DownQuery="часовые срезы"*/
/*UpQuery="посменный"*/

SET QUOTED_IDENTIFIER OFF
Select
	DateAdd(mi, -5, DateTime) as "Дата",
	null,
	CHAR(192+Runtime.dbo.vst_GetShiftNumber(DateTime))
		as "Cмена",
	CAST((L01_EB10P000_H1+L02_EB10P000_H1)/1000 as decimal(15,3))
		as "Выработка<br>эл/эн,<br>тыс.кВт.ч. [(L01_EB10P000_H1+L02_EB10P000_H1)]",
	CAST(((L01_EB10P000_H1+L02_EB10P000_H1)-(L07_EB10P000_H1+L08_EB10P000_H1+L09_EB10P000_H1+L67_EB10P000_H1+L20_EB10P000_H1+L21_EB10P000_H1+L22_EB10P000_H1+L23_EB10P000_H1))/1000 as decimal(15,3))
		as "Отпуск<br>эл/эн,<br>тыс.кВт.ч. [E01-(E19+E20+E21+E22+E23+E24+E25+E26)]",
	CAST((U04_UM31W001_H1+U06_UM31W001_H1+U07_UM31W001_H1+U05_UM31W001_H1+ISNULL(U08_UM31W001_H1, 0)+ISNULL(U01_UN31W001_H1, 0)+U02_UN31W001_H1+U03_UN31W001_H1)/4.187 as decimal(15,2))
		as "Отпуск<br>т/эн,<br>ГКал [Отпуск теплоэнергии, ГКал]",
	CAST(((ISNULL(U01_UN31W001_H1, 0)+U02_UN31W001_H1+U03_UN31W001_H1)/4.187) + ((U04_UM11W002_H1+U06_UM11W002_H1+U07_UM11W002_H1+U05_UM11W002_H1+ISNULL(U08_UM11W002_H1, 0))-(U04_UM21W002_H1+U06_UM21W002_H1+U06_UM22W002_H1+U07_UM21W002_H1+U05_UM21W002_H1+ISNULL(U08_UM21W002_H1, 0))) as decimal(15,2))
		as "корр Отпуск т/эн,<br>ГКал [Отпуск теплоэнергии, ГКал]",
	CAST((U04_UM31W001_H1+U06_UM31W001_H1+U07_UM31W001_H1+U05_UM31W001_H1+ISNULL(U08_UM31W001_H1, 0))/4.187 as decimal(15,2))
		as "Отпуск т/эн<br>водой,<br>ГКал [Отпуск теплоэнергии по магистралям Центр+Док+запад+ВЗРД]",
	CAST(((U04_UM11W002_H1+U06_UM11W002_H1+U07_UM11W002_H1+U05_UM11W002_H1+ISNULL(U08_UM11W002_H1, 0))-(U04_UM21W002_H1+U06_UM21W002_H1+U06_UM22W002_H1+U07_UM21W002_H1+U05_UM21W002_H1+ISNULL(U08_UM21W002_H1, 0))) as decimal(15,2))
		as "корр Отпуск<br>т/эн_водой,<br>ГКал [Отпуск теплоэнергии по магистралям Центр+Док+запад+ВЗРД]",
	CAST((ISNULL(U01_UN31W001_H1, 0)+U02_UN31W001_H1+U03_UN31W001_H1)/4.187 as decimal(15,2)) 
		as "Отпуск т/эн<br>паром,<br>ГКал [Отпуск теплоэнергии по магистралям Док+КИМ+ВЗРД (пар)]",
	CAST(G01_AM31Q701_H1_korr/1000 as decimal(15,3))
		as "Расход газа,<br>тыс. м3/ч [G01_AM31Q701_H1]",
	CAST(G01_AM31Q701_H1_korr*G00_AF00W102/7/1000 as decimal(15,3))
		as "Расход<br>усл._топл,<br>ТУТ [G01_AM31Q701_H1*G00_AF00W102/7]",
	CAST(MI_URT_OE as decimal(15,3))
		as "Уд. расх.<br>топл. [MI_URT_OE]",
	CAST((MI_URT_OE*((L01_EB10P000_H1+L02_EB10P000_H1)-(L07_EB10P000_H1+L08_EB10P000_H1+L09_EB10P000_H1+L67_EB10P000_H1+L20_EB10P000_H1+L21_EB10P000_H1+
	L22_EB10P000_H1+L23_EB10P000_H1))/1000)/1000 as decimal(15,2))
		as "Расх. топл.<br>на_отп._ЭЭ,<br>ТУТ [Расход топлива на отпуск электроэнергии]",
	CAST(G01_AM31Q701_H1_korr*G00_AF00W102/7/1000-MI_URT_OE*((L01_EB10P000_H1+L02_EB10P000_H1)-(L07_EB10P000_H1+L08_EB10P000_H1+L09_EB10P000_H1+L67_EB10P000_H1+L20_EB10P000_H1
	+L21_EB10P000_H1+L22_EB10P000_H1+L23_EB10P000_H1))/1000*0.001 as decimal(15,2))
		as "Расх. топл.<br>на_отп._ТЭ,<br>ТУТ [Расход топлива на отпуск теплоэнергии]",
	CAST((G01_AM31Q701_H1_korr*G00_AF00W102/7/1000-MI_URT_OE*((L01_EB10P000_H1+L02_EB10P000_H1)-(L07_EB10P000_H1+L08_EB10P000_H1+L09_EB10P000_H1+L67_EB10P000_H1+L20_EB10P000_H1+L21_EB10P000_H1+L22_EB10P000_H1+L23_EB10P000_H1))/1000*0.001)/((U04_UM31W001_H1+U06_UM31W001_H1+U07_UM31W001_H1+U05_UM31W001_H1+ISNULL(U08_UM31W001_H1, 0)+ISNULL(U01_UN31W001_H1, 0)+U02_UN31W001_H1+U03_UN31W001_H1)/4.187)*1000 as decimal(15,3))
		as "Уд. расх. топл.<br>на_отп._ТЭ,<br>кг/ГКал [Удельный Расход топлива на отпуск теплоэнергии при заданом Вээ, кг/ГКал]",
	CAST(dbo.vst_SafeDIV((G01_AM31Q701_H1_korr*G00_AF00W102/7/1000-MI_URT_OE*((L01_EB10P000_H1+L02_EB10P000_H1)-(L07_EB10P000_H1+L08_EB10P000_H1+L09_EB10P000_H1+L67_EB10P000_H1+L20_EB10P000_H1+L21_EB10P000_H1+L22_EB10P000_H1+L23_EB10P000_H1))/1000*0.001),((ISNULL(U01_UN31W001_H1, 0)+U02_UN31W001_H1+U03_UN31W001_H1)/4.187) + ((U04_UM11W002_H1+U06_UM11W002_H1+U07_UM11W002_H1+U05_UM11W002_H1+ISNULL(U08_UM11W002_H1, 0))-(U04_UM21W002_H1+U06_UM21W002_H1+U06_UM22W002_H1+U07_UM21W002_H1+U05_UM21W002_H1+ISNULL(U08_UM21W002_H1, 0))))*1000 as decimal(15,3))
		as "корр Уд. расх.<br>топл._на_отп._ТЭ,<br>кг/ГКал [Удельный Расход топлива на отпуск теплоэнергии при заданом Вээ, кг/ГКал]",
	CAST(100*(0.86*((L01_EB10P000_H1+L02_EB10P000_H1)-(L07_EB10P000_H1+L08_EB10P000_H1+L09_EB10P000_H1+L67_EB10P000_H1+L20_EB10P000_H1+L21_EB10P000_H1+L22_EB10P000_H1+L23_EB10P000_H1))/1000+(U04_UM31W001_H1+U06_UM31W001_H1+U07_UM31W001_H1+U05_UM31W001_H1+ISNULL(U08_UM31W001_H1, 0)+ISNULL(U01_UN31W001_H1, 0)+U02_UN31W001_H1+U03_UN31W001_H1)/4.187)/(G01_AM31Q701_H1_korr*G00_AF00W102/7/1000*7) as decimal(15,2))
		as "КПД топливо<br>использования,<br>% [КПД топливоиспользования ТЭЦ, %]",
	CAST(100*dbo.vst_SafeDIV((0.86*((L01_EB10P000_H1+L02_EB10P000_H1)-(L07_EB10P000_H1+L08_EB10P000_H1+L09_EB10P000_H1+L67_EB10P000_H1+L20_EB10P000_H1+L21_EB10P000_H1+L22_EB10P000_H1+L23_EB10P000_H1))/1000+(U04_UM31W001_H1+U06_UM31W001_H1+U07_UM31W001_H1+U05_UM31W001_H1+ISNULL(U08_UM31W001_H1, 0)+ISNULL(U01_UN31W001_H1, 0)+U02_UN31W001_H1+U03_UN31W001_H1)
	/4.187),(G01_AM31Q701_H1_korr*G00_AF00W102/7/1000*7)) as decimal(15,2))
		as "КПД топливо<br>использования,% [КПД топливоиспользования ТЭЦ, %]",
	CAST(100*dbo.vst_SafeDIV((0.86*((L01_EB10P000_H1+L02_EB10P000_H1)-(L07_EB10P000_H1+L08_EB10P000_H1+L09_EB10P000_H1+L67_EB10P000_H1+L20_EB10P000_H1+L21_EB10P000_H1+L22_EB10P000_H1+L23_EB10P000_H1))/1000+((ISNULL(U01_UN31W001_H1, 0)+U02_UN31W001_H1+U03_UN31W001_H1)/4.187) + ((U04_UM11W002_H1+U06_UM11W002_H1+U07_UM11W002_H1+U05_UM11W002_H1+ISNULL(U08_UM11W002_H1, 0))-(U04_UM21W002_H1+U06_UM21W002_H1+U06_UM22W002_H1+U07_UM21W002_H1+U05_UM21W002_H1+ISNULL(U08_UM21W002_H1, 0)))),(G01_AM31Q701_H1_korr*G00_AF00W102/7/1000*7)) as decimal(15,2))
		as "корр<br>КПД_ТИ,<br>% [КПД топливоиспользования ТЭЦ, %]"
FROM (
	SELECT *,
		CASE WHEN DateTime >= '20211008 15:49:00' AND DateTime <= '20211026 10:00:00' THEN G01_AM31Q701_H1 / 1000 ELSE G01_AM31Q701_H1 END AS G01_AM31Q701_H1_korr
	FROM
		OpenQuery(INSQL,
		"SELECT DateTime,
		U04_UM11W002_H1, U06_UM11W002_H1, U07_UM11W002_H1, U05_UM11W002_H1, U04_UM21W002_H1, U06_UM21W002_H1, U06_UM22W002_H1, U07_UM21W002_H1, U05_UM21W002_H1, U08_UM21W002_H1, U08_UM11W002_H1, U08_UM31W001_H1,
		L01_EB10P000_H1, L02_EB10P000_H1, L07_EB10P000_H1, L08_EB10P000_H1, L09_EB10P000_H1, L67_EB10P000_H1, L20_EB10P000_H1, L21_EB10P000_H1, L22_EB10P000_H1, L23_EB10P000_H1, MI_URT_OE, CLC_ShiftDuty,
		U04_UM31W001_H1, U06_UM31W001_H1, U07_UM31W001_H1, U05_UM31W001_H1, U01_UN31W001_H1, U02_UN31W001_H1, U03_UN31W001_H1,
		G01_AM31Q701_H1, G00_AF00W102
		FROM Runtime.dbo.AnalogWideHistory
		WHERE wwVersion = 'Latest'
		AND wwRetrievalMode = 'Cyclic'
		AND wwResolution = @resolution
		AND DateTime >= @start
		AND DateTime <= @finish")
) AS T1


{посменный}
/*ReportName="Показатели экономичности (эком)"(агрегированные часовые данные по сменам)*/
/*Mode=посменный*/
/*DownQuery="часовые срезы по сменам 8/12"*/
/*UpQuery="смены за месяц"*/

SET QUOTED_IDENTIFIER OFF
select
	--DateAdd(hh, 20, Convert(DateTime, Round(Convert(float, DateAdd(mi, -500, Max(DateTime))) * 2, 0, 1) / 2)) as 'DateMarker',
	DateAdd(mi,480,Convert(DateTime,Round(Convert(float,DateAdd(mi,-500,DateTime))*2,0,1)/2)) as 'Дата',
	null,
	CHAR(192+Runtime.dbo.vst_GetShiftNumber(MIN(DateTime)))
		as "Cмена",
	CAST(sum((L01_EB10P000_H1+L02_EB10P000_H1))/1000 as decimal(15,3))
		as "Выработка Эл/эн, тыс.кВт.ч. [(L01_EB10P000_H1+L02_EB10P000_H1)]",
	CAST(sum((L01_EB10P000_H1+L02_EB10P000_H1)-(L07_EB10P000_H1+L08_EB10P000_H1+L09_EB10P000_H1+L67_EB10P000_H1+L20_EB10P000_H1+L21_EB10P000_H1+L22_EB10P000_H1+
	L23_EB10P000_H1))/1000 as decimal(15,3))
		as "Отпуск Эл/эн, тыс.кВт.ч. [E01-(E19+E20+E21+E22+E23+E24+E25+E26)]",
	CAST(sum(U04_UM31W001_H1+U06_UM31W001_H1+U07_UM31W001_H1+U05_UM31W001_H1+ISNULL(U08_UM31W001_H1, 0)+ISNULL(U01_UN31W001_H1, 0)+U02_UN31W001_H1+U03_UN31W001_H1)/4.187
	as decimal(15,3))
		as "Отпуск т/эн, ГКал [Отпуск теплоэнергии, ГКал]",
	CAST(sum(((ISNULL(U01_UN31W001_H1, 0)+U02_UN31W001_H1+U03_UN31W001_H1)/4.187) + ((U04_UM11W002_H1+U06_UM11W002_H1+U07_UM11W002_H1+U05_UM11W002_H1+ISNULL(U08_UM11W002_H1, 0))-(U04_UM21W002_H1+U06_UM21W002_H1+U06_UM22W002_H1+U07_UM21W002_H1+U05_UM21W002_H1+ISNULL(U08_UM21W002_H1, 0)))) as decimal(15,2))
		as "корр Отпуск т/эн, ГКал [Отпуск теплоэнергии, ГКал]",
	CAST(sum(U04_UM31W001_H1+U06_UM31W001_H1+U07_UM31W001_H1+U05_UM31W001_H1+ISNULL(U08_UM31W001_H1, 0))/4.187 as decimal(15,3))
		as "Отпуск т/эн водой, ГКал [Отпуск теплоэнергии по магистралям Центр+Док+запад+ВЗРД]",
	CAST(sum(((U04_UM11W002_H1+U06_UM11W002_H1+U07_UM11W002_H1+U05_UM11W002_H1+ISNULL(U08_UM11W002_H1, 0))-(U04_UM21W002_H1+U06_UM21W002_H1+U06_UM22W002_H1+U07_UM21W002_H1+U05_UM21W002_H1+ISNULL(U08_UM21W002_H1, 0)))) as decimal(15,2))
		as "корр Отпуск т/эн водой, ГКал [Отпуск теплоэнергии по магистралям Центр+Док+запад+ВЗРД]",
	CAST(sum(ISNULL(U01_UN31W001_H1, 0)+U02_UN31W001_H1+U03_UN31W001_H1)/4.187 as decimal(15,3))
		as "Отпуск т/эн паром, ГКал [Отпуск теплоэнергии по магистралям Док+КИМ+ВЗРД (пар)]",
	CAST(sum(G01_AM31Q701_H1_korr)/1000 as decimal(15,3))
		as "Расход газа, тыс. м3/ч [G01_AM31Q701_H1]",
	CAST(sum(G01_AM31Q701_H1_korr*G00_AF00W102)/7/1000 as decimal(15,3))
		as "Расход Усл. Топл, ТУТ [G01_AM31Q701_H1*G00_AF00W102/7]",
	CAST(avg(MI_URT_OE) as decimal(15,3))
		as "Уд. расх. топл. [MI_URT_OE]",
	CAST(avg(MI_URT_OE)*(sum((L01_EB10P000_H1+L02_EB10P000_H1)-(L07_EB10P000_H1+L08_EB10P000_H1+L09_EB10P000_H1+L67_EB10P000_H1+L20_EB10P000_H1+
	L21_EB10P000_H1+L22_EB10P000_H1+L23_EB10P000_H1))/1000)/1000 as decimal(15,3))
		as "Расх. топл. на отп. ЭЭ, ТУТ [Расход топлива на отпуск электроэнергии]",
	CAST(sum(G01_AM31Q701_H1_korr*G00_AF00W102)/7/1000-(avg(MI_URT_OE)*(sum((L01_EB10P000_H1+L02_EB10P000_H1)-(L07_EB10P000_H1+L08_EB10P000_H1+L09_EB10P000_H1+L67_EB10P000_H1+L20_EB10P000_H1+L21_EB10P000_H1+L22_EB10P000_H1+L23_EB10P000_H1))/1000)/1000) as decimal(15,3))
		as "Расх. топл. на отп. ТЭ, ТУТ [Расход топлива на отпуск теплоэнергии]",
	CAST(dbo.vst_SafeDIV((sum(G01_AM31Q701_H1_korr*G00_AF00W102)/7/1000-(avg(MI_URT_OE)*(sum((L01_EB10P000_H1+L02_EB10P000_H1)-(L07_EB10P000_H1+L08_EB10P000_H1+L09_EB10P000_H1+L67_EB10P000_H1+L20_EB10P000_H1+L21_EB10P000_H1+L22_EB10P000_H1+L23_EB10P000_H1))/1000)/1000)),(sum(U04_UM31W001_H1+U06_UM31W001_H1+U07_UM31W001_H1+U05_UM31W001_H1+ISNULL(U08_UM31W001_H1, 0)+ISNULL(U01_UN31W001_H1, 0)+U02_UN31W001_H1+U03_UN31W001_H1)/4.187))*1000 as decimal(15,3))
		as "Уд. расх. топл. на отп. ТЭ, кг/ГКал [Удельный Расход топлива на отпуск теплоэнергии при заданом Вээ, кг/ГКал]",
	CAST(dbo.vst_SafeDIV(SUM((G01_AM31Q701_H1_korr*G00_AF00W102/7/1000-MI_URT_OE*((L01_EB10P000_H1+L02_EB10P000_H1)-(L07_EB10P000_H1+L08_EB10P000_H1+L09_EB10P000_H1+L67_EB10P000_H1+L20_EB10P000_H1+L21_EB10P000_H1+L22_EB10P000_H1+L23_EB10P000_H1))/1000*0.001)),SUM(((ISNULL(U01_UN31W001_H1, 0)+U02_UN31W001_H1+U03_UN31W001_H1)/4.187) + ((U04_UM11W002_H1+U06_UM11W002_H1+U07_UM11W002_H1+U05_UM11W002_H1+ISNULL(U08_UM11W002_H1, 0))-(U04_UM21W002_H1+U06_UM21W002_H1+U06_UM22W002_H1+U07_UM21W002_H1+U05_UM21W002_H1+ISNULL(U08_UM21W002_H1, 0)))))*1000 as decimal(15,3))
		as "корр Уд. расх. топл. на отп. ТЭ, кг/ГКал [Удельный Расход топлива на отпуск теплоэнергии при заданом Вээ, кг/ГКал]",
	CAST(100*dbo.vst_SafeDIV((0.86*(sum((L01_EB10P000_H1+L02_EB10P000_H1)-(L07_EB10P000_H1+L08_EB10P000_H1+L09_EB10P000_H1+L67_EB10P000_H1+L20_EB10P000_H1+L21_EB10P000_H1+L22_EB10P000_H1+L23_EB10P000_H1))/1000)+(sum(U04_UM31W001_H1+U06_UM31W001_H1+U07_UM31W001_H1+U05_UM31W001_H1+ISNULL(U08_UM31W001_H1, 0)+ISNULL(U01_UN31W001_H1, 0)+U02_UN31W001_H1+U03_UN31W001_H1)/4.187)),((sum(G01_AM31Q701_H1_korr*G00_AF00W102)/7/1000)*7))
		as decimal(15,2)) as "КПД топливо<br>использования,% [КПД топливоиспользования ТЭЦ, %]",
	CAST(100*dbo.vst_SafeDIV((0.86*(sum((L01_EB10P000_H1+L02_EB10P000_H1)-(L07_EB10P000_H1+L08_EB10P000_H1+L09_EB10P000_H1+L67_EB10P000_H1+L20_EB10P000_H1+L21_EB10P000_H1+L22_EB10P000_H1+L23_EB10P000_H1))/1000)+(sum(((ISNULL(U01_UN31W001_H1, 0)+U02_UN31W001_H1+U03_UN31W001_H1)/4.187) + ((U04_UM11W002_H1+U06_UM11W002_H1+U07_UM11W002_H1+U05_UM11W002_H1+ISNULL(U08_UM11W002_H1, 0))-(U04_UM21W002_H1+U06_UM21W002_H1+U06_UM22W002_H1+U07_UM21W002_H1+U05_UM21W002_H1+ISNULL(U08_UM21W002_H1, 0)))))),((sum(G01_AM31Q701_H1_korr*G00_AF00W102)/7/1000)*7))
		as decimal(15,2)) as "корр<br>КПД_ТИ,<br>% [КПД топливоиспользования ТЭЦ, %]"
FROM (
	SELECT *,
		CASE WHEN DateTime >= '20211008 15:49:00' AND DateTime <= '20211026 10:00:00' THEN G01_AM31Q701_H1 / 1000 ELSE G01_AM31Q701_H1 END AS G01_AM31Q701_H1_korr
	FROM
		OpenQuery(INSQL,
		"SELECT DateTime,
		CLC_ShiftDuty,
		U04_UM11W002_H1, U06_UM11W002_H1, U07_UM11W002_H1, U05_UM11W002_H1, U04_UM21W002_H1, U06_UM21W002_H1, U06_UM22W002_H1, U07_UM21W002_H1,
		L01_EB10P000_H1, L02_EB10P000_H1, L07_EB10P000_H1, L08_EB10P000_H1, L09_EB10P000_H1, L67_EB10P000_H1, L20_EB10P000_H1, L21_EB10P000_H1, L22_EB10P000_H1, L23_EB10P000_H1, MI_URT_OE,
		U04_UM31W001_H1, U06_UM31W001_H1, U07_UM31W001_H1, U05_UM31W001_H1, U05_UM21W002_H1, U08_UM21W002_H1, U08_UM11W002_H1, U08_UM31W001_H1, U01_UN31W001_H1, U02_UN31W001_H1, U03_UN31W001_H1,
		G01_AM31Q701_H1, G00_AF00W102
		FROM Runtime.dbo.AnalogWideHistory
		WHERE wwVersion = 'Latest'
		AND wwRetrievalMode = 'Cyclic'
		AND wwResolution = @resolution
		AND DateTime >= @start
		AND DateTime <= @finish")
) AS T1
GROUP BY
	DateAdd(mi,480,Convert(DateTime,Round(Convert(float,DateAdd(mi,-500,DateTime))*2,0,1)/2))
Order By
	DateAdd(mi,480,Convert(DateTime,Round(Convert(float,DateAdd(mi,-500,DateTime))*2,0,1)/2))


{Смена А за месяц}
/*ReportName="Показатели экономичности (эком)"(СМЕНА А ЗА МЕСЯЦ)*/
/*Mode=смены за месяц*/
/*DownQuery="часовые срезы по сменам 8/12"*/
/*UpQuery="смены за месяц"*/
SET QUOTED_IDENTIFIER OFF
select
	--'02' + Right(Convert(char(10), MIN(DateTime), 104), 8) as 'DateMarker',
	DateAdd(mi, 480, Convert(DateTime, Round(Convert(float, DateAdd(mi, -500, DateTime)) * 2, 0, 1) / 2)) as 'Дата',
	null,
	CHAR(192 + Runtime.dbo.vst_GetShiftNumber(MIN(DateTime)))
		as "Cмена",
	CAST(sum((L01_EB10P000_H1+L02_EB10P000_H1))/1000 as decimal(15,3))
		as "Выработка Эл/эн, тыс.кВт.ч. [(L01_EB10P000_H1+L02_EB10P000_H1)]",
	CAST(sum((L01_EB10P000_H1+L02_EB10P000_H1)-(L07_EB10P000_H1+L08_EB10P000_H1+L09_EB10P000_H1+L67_EB10P000_H1+L20_EB10P000_H1+L21_EB10P000_H1+L22_EB10P000_H1+L23_EB10P000_H1))/1000 as decimal(15,3))
		as "Отпуск Эл/эн, тыс.кВт.ч. [E01-(E19+E20+E21+E22+E23+E24+E25+E26)]",
	CAST(sum(U04_UM31W001_H1+U06_UM31W001_H1+U07_UM31W001_H1+U05_UM31W001_H1+ISNULL(U08_UM31W001_H1, 0)+ISNULL(U01_UN31W001_H1, 0)+U02_UN31W001_H1+U03_UN31W001_H1)/4.187 as decimal(15,3))
		as "Отпуск т/эн, ГКал [Отпуск теплоэнергии, ГКал]",
	CAST(sum(((ISNULL(U01_UN31W001_H1, 0)+U02_UN31W001_H1+U03_UN31W001_H1)/4.187) + ((U04_UM11W002_H1+U06_UM11W002_H1+U07_UM11W002_H1+U05_UM11W002_H1+ISNULL(U08_UM11W002_H1, 0))-(U04_UM21W002_H1+U06_UM21W002_H1+U06_UM22W002_H1+U07_UM21W002_H1+U05_UM21W002_H1+ISNULL(U08_UM21W002_H1, 0))))	as decimal(15,2))
		as "корр Отпуск т/эн, ГКал [Отпуск теплоэнергии, ГКал]",
	CAST(sum(U04_UM31W001_H1+U06_UM31W001_H1+U07_UM31W001_H1+U05_UM31W001_H1+ISNULL(U08_UM31W001_H1, 0))/4.187 as decimal(15,3))
		as "Отпуск т/эн водой, ГКал [Отпуск теплоэнергии по магистралям Центр+Док+запад+ВЗРД]",
	CAST(sum(((U04_UM11W002_H1+U06_UM11W002_H1+U07_UM11W002_H1+U05_UM11W002_H1+ISNULL(U08_UM11W002_H1, 0))-(U04_UM21W002_H1+U06_UM21W002_H1+U06_UM22W002_H1+U07_UM21W002_H1+U05_UM21W002_H1+ISNULL(U08_UM21W002_H1, 0)))) as decimal(15,2))
		as "корр Отпуск т/эн водой, ГКал [Отпуск теплоэнергии по магистралям Центр+Док+запад+ВЗРД]",
	CAST(sum(ISNULL(U01_UN31W001_H1, 0)+U02_UN31W001_H1+U03_UN31W001_H1)/4.187 as decimal(15,3))
		as "Отпуск т/эн паром, ГКал [Отпуск теплоэнергии по магистралям Док+КИМ+ВЗРД (пар)]",
	CAST(sum(G01_AM31Q701_H1_korr)/1000 as decimal(15,3))
		as "Расход газа, тыс. м3/ч [G01_AM31Q701_H1]",
	CAST(sum(G01_AM31Q701_H1_korr*G00_AF00W102)/7/1000 as decimal(15,3))
		as "Расход Усл. Топл, ТУТ [G01_AM31Q701_H1*G00_AF00W102/7]",
	CAST(avg(MI_URT_OE) as decimal(15,3))
		as "Уд. расх. топл. [MI_URT_OE]",
	CAST(avg(MI_URT_OE) * sum(((L01_EB10P000_H1+L02_EB10P000_H1) - (L07_EB10P000_H1+L08_EB10P000_H1+L09_EB10P000_H1+L67_EB10P000_H1+L20_EB10P000_H1+L21_EB10P000_H1+L22_EB10P000_H1+L23_EB10P000_H1))/ 1000)/1000 as decimal(15,3))
		as "Расх. топл. на отп. ЭЭ, ТУТ [Расход топлива на отпуск электроэнергии]",
	CAST(sum(G01_AM31Q701_H1_korr*G00_AF00W102)/7/1000-(avg(MI_URT_OE)*(sum((L01_EB10P000_H1+L02_EB10P000_H1)-(L07_EB10P000_H1+L08_EB10P000_H1+L09_EB10P000_H1+L67_EB10P000_H1+L20_EB10P000_H1+L21_EB10P000_H1+L22_EB10P000_H1+L23_EB10P000_H1))/1000)/1000) as decimal(15,3))
		as "Расх. топл. на отп. ТЭ, ТУТ [Расход топлива на отпуск теплоэнергии]",
	CAST(dbo.vst_SafeDIV((sum(G01_AM31Q701_H1_korr*G00_AF00W102)/7/1000-(avg(MI_URT_OE)*(sum((L01_EB10P000_H1+L02_EB10P000_H1)-(L07_EB10P000_H1+L08_EB10P000_H1+L09_EB10P000_H1+L67_EB10P000_H1+L20_EB10P000_H1+L21_EB10P000_H1+L22_EB10P000_H1+L23_EB10P000_H1))/1000)/1000)),(sum(U04_UM31W001_H1+U06_UM31W001_H1+U07_UM31W001_H1+U05_UM31W001_H1+ISNULL(U08_UM31W001_H1, 0)+ISNULL(U01_UN31W001_H1, 0)+U02_UN31W001_H1+U03_UN31W001_H1)/4.187))*1000 as decimal(15,3))
		as "Уд. расх. топл. на отп. ТЭ, кг/ГКал [Удельный Расход топлива на отпуск теплоэнергии при заданом Вээ, кг/ГКал]",
	CAST(dbo.vst_SafeDIV(SUM((G01_AM31Q701_H1_korr*G00_AF00W102/7/1000-MI_URT_OE*((L01_EB10P000_H1+L02_EB10P000_H1)-(L07_EB10P000_H1+L08_EB10P000_H1+L09_EB10P000_H1+L67_EB10P000_H1+L20_EB10P000_H1+L21_EB10P000_H1+L22_EB10P000_H1+L23_EB10P000_H1))/1000*0.001)),SUM(((ISNULL(U01_UN31W001_H1, 0)+U02_UN31W001_H1+U03_UN31W001_H1)/4.187) + ((U04_UM11W002_H1+U06_UM11W002_H1+U07_UM11W002_H1+U05_UM11W002_H1+ISNULL(U08_UM11W002_H1, 0))-(U04_UM21W002_H1+U06_UM21W002_H1+U06_UM22W002_H1+U07_UM21W002_H1+U05_UM21W002_H1+ISNULL(U08_UM21W002_H1, 0)))))*1000 as decimal(15,3))
		as "корр Уд. расх. топл. на отп. ТЭ, кг/ГКал [Удельный Расход топлива на отпуск теплоэнергии при заданом Вээ, кг/ГКал]",
	CAST(100*dbo.vst_SafeDIV((0.86*(sum((L01_EB10P000_H1+L02_EB10P000_H1)-(L07_EB10P000_H1+L08_EB10P000_H1+L09_EB10P000_H1+L67_EB10P000_H1+L20_EB10P000_H1+L21_EB10P000_H1+L22_EB10P000_H1+L23_EB10P000_H1))/1000)+(sum(U04_UM31W001_H1+U06_UM31W001_H1+U07_UM31W001_H1+U05_UM31W001_H1+ISNULL(U08_UM31W001_H1, 0)+ISNULL(U01_UN31W001_H1, 0)+U02_UN31W001_H1+U03_UN31W001_H1)/4.187)),((sum(G01_AM31Q701_H1_korr*G00_AF00W102)/7/1000)*7)) as decimal(15,2))
		as "КПД топливо<br>использования,% [КПД топливоиспользования ТЭЦ, %]",
	CAST(100*dbo.vst_SafeDIV((0.86*(sum((L01_EB10P000_H1+L02_EB10P000_H1)-(L07_EB10P000_H1+L08_EB10P000_H1+L09_EB10P000_H1+L67_EB10P000_H1+L20_EB10P000_H1+L21_EB10P000_H1+L22_EB10P000_H1+L23_EB10P000_H1))/1000)+(sum(((ISNULL(U01_UN31W001_H1, 0)+U02_UN31W001_H1+U03_UN31W001_H1)/4.187) + ((U04_UM11W002_H1+U06_UM11W002_H1+U07_UM11W002_H1+U05_UM11W002_H1+ISNULL(U08_UM11W002_H1, 0))-(U04_UM21W002_H1+U06_UM21W002_H1+U06_UM22W002_H1+U07_UM21W002_H1+U05_UM21W002_H1+ISNULL(U08_UM21W002_H1, 0)))))),((sum(G01_AM31Q701_H1_korr*G00_AF00W102)/7/1000)*7)) as decimal(15,2))
		as "корр<br>КПД_ТИ,<br>% [КПД топливоиспользования ТЭЦ, %]"
FROM (
	SELECT *,
		CASE WHEN DateTime >= '20211008 15:49:00' AND DateTime <= '20211026 10:00:00' THEN G01_AM31Q701_H1 / 1000 ELSE G01_AM31Q701_H1 END AS G01_AM31Q701_H1_korr
	FROM
		OpenQuery(INSQL,
		"SELECT DateTime, CLC_ShiftDuty,
		U04_UM11W002_H1, U06_UM11W002_H1, U07_UM11W002_H1, U05_UM11W002_H1, U04_UM21W002_H1, U06_UM21W002_H1, U06_UM22W002_H1, U07_UM21W002_H1,
		U05_UM21W002_H1, L01_EB10P000_H1, L02_EB10P000_H1, L07_EB10P000_H1, L08_EB10P000_H1, L09_EB10P000_H1, L67_EB10P000_H1, L20_EB10P000_H1,
		L21_EB10P000_H1, L22_EB10P000_H1, L23_EB10P000_H1, MI_URT_OE,
		U04_UM31W001_H1, U06_UM31W001_H1, U07_UM31W001_H1, U05_UM31W001_H1, U08_UM21W002_H1, U08_UM11W002_H1, U08_UM31W001_H1,
		U01_UN31W001_H1, U02_UN31W001_H1, U03_UN31W001_H1, G01_AM31Q701_H1, G00_AF00W102
		FROM Runtime.dbo.AnalogWideHistory
		WHERE wwVersion = 'Latest'
		AND wwRetrievalMode = 'Cyclic'
		AND wwResolution = @resolution
		AND DateTime >= @start
		AND DateTime <= @finish")
) AS T1
WHERE
	Runtime.dbo.vst_GetShiftNumber(DateTime) = 0
GROUP BY
	DateAdd(mi,480,Convert(DateTime,Round(Convert(float,DateAdd(mi,-500,DateTime))*2,0,1)/2))
Order By
	DateAdd(mi,480,Convert(DateTime,Round(Convert(float,DateAdd(mi,-500,DateTime))*2,0,1)/2))


{Смена Б за месяц}
/*ReportName="Показатели экономичности (эком)"(СМЕНА Б ЗА МЕСЯЦ)*/
/*Mode=смены за месяц*/
/*DownQuery="часовые срезы по сменам 8/12"*/
/*UpQuery="смены за месяц"*/

SET QUOTED_IDENTIFIER OFF
select
	--'02' + Right(Convert(char(10), MIN(DateTime), 104), 8) as 'DateMarker',
	DateAdd(mi, 480, Convert(DateTime, Round(Convert(float, DateAdd(mi, -500, DateTime))*  2, 0, 1) / 2)) as 'Дата',
	null,
	CHAR(192 + Runtime.dbo.vst_GetShiftNumber(MIN(DateTime)))
		as "Cмена",
	CAST(sum((L01_EB10P000_H1+L02_EB10P000_H1))/1000 as decimal(15,3))
		as "Выработка Эл/эн, тыс.кВт.ч. [(L01_EB10P000_H1+L02_EB10P000_H1)]",
	CAST(sum((L01_EB10P000_H1+L02_EB10P000_H1)-(L07_EB10P000_H1+L08_EB10P000_H1+L09_EB10P000_H1+L67_EB10P000_H1+L20_EB10P000_H1+L21_EB10P000_H1+L22_EB10P000_H1+L23_EB10P000_H1))/1000 as decimal(15,3))
		as "Отпуск Эл/эн, тыс.кВт.ч. [E01-(E19+E20+E21+E22+E23+E24+E25+E26)]",
	CAST(sum(U04_UM31W001_H1+U06_UM31W001_H1+U07_UM31W001_H1+U05_UM31W001_H1+ISNULL(U08_UM31W001_H1, 0)+ISNULL(U01_UN31W001_H1, 0)+U02_UN31W001_H1+U03_UN31W001_H1)/4.187 as decimal(15,3))
		as "Отпуск т/эн, ГКал [Отпуск теплоэнергии, ГКал]",
	CAST(sum(((ISNULL(U01_UN31W001_H1, 0)+U02_UN31W001_H1+U03_UN31W001_H1)/4.187) + ((U04_UM11W002_H1+U06_UM11W002_H1+U07_UM11W002_H1+U05_UM11W002_H1+ISNULL(U08_UM11W002_H1, 0))-(U04_UM21W002_H1+U06_UM21W002_H1+U06_UM22W002_H1+U07_UM21W002_H1+U05_UM21W002_H1+ISNULL(U08_UM21W002_H1, 0))))	as decimal(15,2)) 
		as "корр Отпуск т/эн, ГКал [Отпуск теплоэнергии, ГКал]",
	CAST(sum(U04_UM31W001_H1+U06_UM31W001_H1+U07_UM31W001_H1+U05_UM31W001_H1+ISNULL(U08_UM31W001_H1, 0))/4.187 as decimal(15,3))
		as "Отпуск т/эн водой, ГКал [Отпуск теплоэнергии по магистралям Центр+Док+запад+ВЗРД]",
	CAST(sum(((U04_UM11W002_H1+U06_UM11W002_H1+U07_UM11W002_H1+U05_UM11W002_H1+ISNULL(U08_UM11W002_H1, 0))-(U04_UM21W002_H1+U06_UM21W002_H1+U06_UM22W002_H1+U07_UM21W002_H1+U05_UM21W002_H1+ISNULL(U08_UM21W002_H1, 0)))) as decimal(15,2))
		as "корр Отпуск т/эн водой, ГКал [Отпуск теплоэнергии по магистралям Центр+Док+запад+ВЗРД]",
	CAST(sum(ISNULL(U01_UN31W001_H1, 0)+U02_UN31W001_H1+U03_UN31W001_H1)/4.187 as decimal(15,3))
		as "Отпуск т/эн паром, ГКал [Отпуск теплоэнергии по магистралям Док+КИМ+ВЗРД (пар)]",
	CAST(sum(G01_AM31Q701_H1_korr)/1000 as decimal(15,3))
		as "Расход газа, тыс. м3/ч [G01_AM31Q701_H1]",
	CAST(sum(G01_AM31Q701_H1_korr*G00_AF00W102)/7/1000 as decimal(15,3))
		as "Расход Усл. Топл, ТУТ [G01_AM31Q701_H1*G00_AF00W102/7]",
	CAST(avg(MI_URT_OE) as decimal(15,3))
		as "Уд. расх. топл. [MI_URT_OE]",
	CAST(avg(MI_URT_OE) * sum(((L01_EB10P000_H1+L02_EB10P000_H1) - (L07_EB10P000_H1+L08_EB10P000_H1+L09_EB10P000_H1+L67_EB10P000_H1+L20_EB10P000_H1+L21_EB10P000_H1+L22_EB10P000_H1+L23_EB10P000_H1))/ 1000)/1000 as decimal(15,3))
		as "Расх. топл. на отп. ЭЭ, ТУТ [Расход топлива на отпуск электроэнергии]",
	CAST(sum(G01_AM31Q701_H1_korr*G00_AF00W102)/7/1000-(avg(MI_URT_OE)*(sum((L01_EB10P000_H1+L02_EB10P000_H1)-(L07_EB10P000_H1+L08_EB10P000_H1+L09_EB10P000_H1+L67_EB10P000_H1+L20_EB10P000_H1+L21_EB10P000_H1+L22_EB10P000_H1+L23_EB10P000_H1))/1000)/1000)as decimal(15,3))
		as "Расх. топл. на отп. ТЭ, ТУТ [Расход топлива на отпуск теплоэнергии]",
	CAST(dbo.vst_SafeDIV((sum(G01_AM31Q701_H1_korr*G00_AF00W102)/7/1000-(avg(MI_URT_OE)*(sum((L01_EB10P000_H1+L02_EB10P000_H1)-(L07_EB10P000_H1+L08_EB10P000_H1+L09_EB10P000_H1+L67_EB10P000_H1+L20_EB10P000_H1+L21_EB10P000_H1+L22_EB10P000_H1+L23_EB10P000_H1))/1000)/1000)),(sum(U04_UM31W001_H1+U06_UM31W001_H1+U07_UM31W001_H1+U05_UM31W001_H1+ISNULL(U08_UM31W001_H1, 0)+ISNULL(U01_UN31W001_H1, 0)+U02_UN31W001_H1+U03_UN31W001_H1)/4.187))*1000 as decimal(15,3))
		as "Уд. расх. топл. на отп. ТЭ, кг/ГКал [Удельный Расход топлива на отпуск теплоэнергии при заданом Вээ, кг/ГКал]",
	CAST(dbo.vst_SafeDIV(SUM((G01_AM31Q701_H1_korr*G00_AF00W102/7/1000-MI_URT_OE*((L01_EB10P000_H1+L02_EB10P000_H1)-(L07_EB10P000_H1+L08_EB10P000_H1+L09_EB10P000_H1+L67_EB10P000_H1+L20_EB10P000_H1+L21_EB10P000_H1+L22_EB10P000_H1+L23_EB10P000_H1))/1000*0.001)),SUM(((ISNULL(U01_UN31W001_H1, 0)+U02_UN31W001_H1+U03_UN31W001_H1)/4.187) + ((U04_UM11W002_H1+U06_UM11W002_H1+U07_UM11W002_H1+U05_UM11W002_H1+ISNULL(U08_UM11W002_H1, 0))-(U04_UM21W002_H1+U06_UM21W002_H1+U06_UM22W002_H1+U07_UM21W002_H1+U05_UM21W002_H1+ISNULL(U08_UM21W002_H1, 0)))))*1000 as decimal(15,3))
		as "корр Уд. расх. топл. на отп. ТЭ, кг/ГКал [Удельный Расход топлива на отпуск теплоэнергии при заданом Вээ, кг/ГКал]",
	CAST(100*dbo.vst_SafeDIV((0.86*(sum((L01_EB10P000_H1+L02_EB10P000_H1)-(L07_EB10P000_H1+L08_EB10P000_H1+L09_EB10P000_H1+L67_EB10P000_H1+L20_EB10P000_H1+L21_EB10P000_H1+L22_EB10P000_H1+L23_EB10P000_H1))/1000)+(sum(U04_UM31W001_H1+U06_UM31W001_H1+U07_UM31W001_H1+U05_UM31W001_H1+ISNULL(U08_UM31W001_H1, 0)+ISNULL(U01_UN31W001_H1, 0)+U02_UN31W001_H1+U03_UN31W001_H1)/4.187)),((sum(G01_AM31Q701_H1_korr*G00_AF00W102)/7/1000)*7))
		as decimal(15,2)) as "КПД топливо<br>использования,% [КПД топливоиспользования ТЭЦ, %]",
	CAST(100*dbo.vst_SafeDIV((0.86*(sum((L01_EB10P000_H1+L02_EB10P000_H1)-(L07_EB10P000_H1+L08_EB10P000_H1+L09_EB10P000_H1+L67_EB10P000_H1+L20_EB10P000_H1+L21_EB10P000_H1+L22_EB10P000_H1+L23_EB10P000_H1))/1000)+(sum(((ISNULL(U01_UN31W001_H1, 0)+U02_UN31W001_H1+U03_UN31W001_H1)/4.187) + ((U04_UM11W002_H1+U06_UM11W002_H1+U07_UM11W002_H1+U05_UM11W002_H1+ISNULL(U08_UM11W002_H1, 0))-(U04_UM21W002_H1+U06_UM21W002_H1+U06_UM22W002_H1+U07_UM21W002_H1+U05_UM21W002_H1+ISNULL(U08_UM21W002_H1, 0))))
	)),((sum(G01_AM31Q701_H1_korr*G00_AF00W102)/7/1000)*7)) as decimal(15,2))
		as "корр<br>КПД_ТИ,<br>% [КПД топливоиспользования ТЭЦ, %]"
FROM (
	SELECT *,
		CASE WHEN DateTime >= '20211008 15:49:00' AND DateTime <= '20211026 10:00:00' THEN G01_AM31Q701_H1 / 1000 ELSE G01_AM31Q701_H1 END AS G01_AM31Q701_H1_korr
	FROM
		OpenQuery(INSQL,
		"SELECT DateTime, CLC_ShiftDuty,
		U04_UM11W002_H1, U06_UM11W002_H1, U07_UM11W002_H1, U05_UM11W002_H1, U04_UM21W002_H1, U06_UM21W002_H1, U06_UM22W002_H1, U07_UM21W002_H1,
		U05_UM21W002_H1, L01_EB10P000_H1, L02_EB10P000_H1, L07_EB10P000_H1, L08_EB10P000_H1, L09_EB10P000_H1, L67_EB10P000_H1, L20_EB10P000_H1,
		L21_EB10P000_H1, L22_EB10P000_H1, L23_EB10P000_H1, MI_URT_OE,
		U04_UM31W001_H1, U06_UM31W001_H1, U07_UM31W001_H1, U05_UM31W001_H1, U08_UM21W002_H1, U08_UM11W002_H1, U08_UM31W001_H1,
		U01_UN31W001_H1, U02_UN31W001_H1, U03_UN31W001_H1, G01_AM31Q701_H1, G00_AF00W102
		FROM Runtime.dbo.AnalogWideHistory
		WHERE wwVersion = 'Latest'
		AND wwRetrievalMode = 'Cyclic'
		AND wwResolution = @resolution
		AND DateTime >= @start
		AND DateTime <= @finish")
) AS T1
WHERE
	Runtime.dbo.vst_GetShiftNumber(DateTime) = 1
GROUP BY
	DateAdd(mi,480,Convert(DateTime,Round(Convert(float,DateAdd(mi,-500,DateTime))*2,0,1)/2))
Order By
	DateAdd(mi,480,Convert(DateTime,Round(Convert(float,DateAdd(mi,-500,DateTime))*2,0,1)/2))


{Смена В за месяц}
/*ReportName="Показатели экономичности (эком)"(СМЕНА В ЗА МЕСЯЦ)*/
/*Mode=смены за месяц*/
/*DownQuery="часовые срезы по сменам 8/12"*/
/*UpQuery="смены за месяц"*/

SET QUOTED_IDENTIFIER OFF
select
	--'02' + Right(Convert(char(10), MIN(DateTime), 104), 8) as 'DateMarker',
	DateAdd(mi, 480, Convert(DateTime, Round(Convert(float, DateAdd(mi, -500, DateTime))*  2, 0, 1) / 2)) as 'Дата',
	null,
	CHAR(192 + Runtime.dbo.vst_GetShiftNumber(MIN(DateTime)))
		as "Cмена",
	CAST(sum((L01_EB10P000_H1+L02_EB10P000_H1))/1000 as decimal(15,3))
		as "Выработка Эл/эн, тыс.кВт.ч. [(L01_EB10P000_H1+L02_EB10P000_H1)]",
	CAST(sum((L01_EB10P000_H1+L02_EB10P000_H1)-(L07_EB10P000_H1+L08_EB10P000_H1+L09_EB10P000_H1+L67_EB10P000_H1+L20_EB10P000_H1+L21_EB10P000_H1+L22_EB10P000_H1+L23_EB10P000_H1))/1000 as decimal(15,3))
		as "Отпуск Эл/эн, тыс.кВт.ч. [E01-(E19+E20+E21+E22+E23+E24+E25+E26)]",
	CAST(sum(U04_UM31W001_H1+U06_UM31W001_H1+U07_UM31W001_H1+U05_UM31W001_H1+ISNULL(U08_UM31W001_H1, 0)+ISNULL(U01_UN31W001_H1, 0)+U02_UN31W001_H1+U03_UN31W001_H1)/4.187 as decimal(15,3))
		as "Отпуск т/эн, ГКал [Отпуск теплоэнергии, ГКал]",
	CAST(sum(((ISNULL(U01_UN31W001_H1, 0)+U02_UN31W001_H1+U03_UN31W001_H1)/4.187) + ((U04_UM11W002_H1+U06_UM11W002_H1+U07_UM11W002_H1+U05_UM11W002_H1+ISNULL(U08_UM11W002_H1, 0))-(U04_UM21W002_H1+U06_UM21W002_H1+U06_UM22W002_H1+U07_UM21W002_H1+U05_UM21W002_H1+ISNULL(U08_UM21W002_H1, 0))))	as decimal(15,2)) 
		as "корр Отпуск т/эн, ГКал [Отпуск теплоэнергии, ГКал]",
	CAST(sum(U04_UM31W001_H1+U06_UM31W001_H1+U07_UM31W001_H1+U05_UM31W001_H1+ISNULL(U08_UM31W001_H1, 0))/4.187 as decimal(15,3))
		as "Отпуск т/эн водой, ГКал [Отпуск теплоэнергии по магистралям Центр+Док+запад+ВЗРД]",
	CAST(sum(((U04_UM11W002_H1+U06_UM11W002_H1+U07_UM11W002_H1+U05_UM11W002_H1+ISNULL(U08_UM11W002_H1, 0))-(U04_UM21W002_H1+U06_UM21W002_H1+U06_UM22W002_H1+U07_UM21W002_H1+U05_UM21W002_H1+ISNULL(U08_UM21W002_H1, 0)))) as decimal(15,2))
		as "корр Отпуск т/эн водой, ГКал [Отпуск теплоэнергии по магистралям Центр+Док+запад+ВЗРД]",
	CAST(sum(ISNULL(U01_UN31W001_H1, 0)+U02_UN31W001_H1+U03_UN31W001_H1)/4.187 as decimal(15,3))
		as "Отпуск т/эн паром, ГКал [Отпуск теплоэнергии по магистралям Док+КИМ+ВЗРД (пар)]",
	CAST(sum(G01_AM31Q701_H1_korr)/1000 as decimal(15,3))
		as "Расход газа, тыс. м3/ч [G01_AM31Q701_H1]",
	CAST(sum(G01_AM31Q701_H1_korr*G00_AF00W102)/7/1000 as decimal(15,3))
		as "Расход Усл. Топл, ТУТ [G01_AM31Q701_H1*G00_AF00W102/7]",
	CAST(avg(MI_URT_OE) as decimal(15,3))
		as "Уд. расх. топл. [MI_URT_OE]",
	CAST(avg(MI_URT_OE) * sum(((L01_EB10P000_H1+L02_EB10P000_H1) - (L07_EB10P000_H1+L08_EB10P000_H1+L09_EB10P000_H1+L67_EB10P000_H1+L20_EB10P000_H1+L21_EB10P000_H1+L22_EB10P000_H1+L23_EB10P000_H1))/ 1000)/1000 as decimal(15,3))
		as "Расх. топл. на отп. ЭЭ, ТУТ [Расход топлива на отпуск электроэнергии]",
	CAST(sum(G01_AM31Q701_H1_korr*G00_AF00W102)/7/1000-(avg(MI_URT_OE)*(sum((L01_EB10P000_H1+L02_EB10P000_H1)-(L07_EB10P000_H1+L08_EB10P000_H1+L09_EB10P000_H1+L67_EB10P000_H1+L20_EB10P000_H1+L21_EB10P000_H1+L22_EB10P000_H1+L23_EB10P000_H1))/1000)/1000)as decimal(15,3))
		as "Расх. топл. на отп. ТЭ, ТУТ [Расход топлива на отпуск теплоэнергии]",
	CAST(dbo.vst_SafeDIV((sum(G01_AM31Q701_H1_korr*G00_AF00W102)/7/1000-(avg(MI_URT_OE)*(sum((L01_EB10P000_H1+L02_EB10P000_H1)-(L07_EB10P000_H1+L08_EB10P000_H1+L09_EB10P000_H1+L67_EB10P000_H1+L20_EB10P000_H1+L21_EB10P000_H1+L22_EB10P000_H1+L23_EB10P000_H1))/1000)/1000)),(sum(U04_UM31W001_H1+U06_UM31W001_H1+U07_UM31W001_H1+U05_UM31W001_H1+ISNULL(U08_UM31W001_H1, 0)+ISNULL(U01_UN31W001_H1, 0)+U02_UN31W001_H1+U03_UN31W001_H1)/4.187))*1000 as decimal(15,3))
		as "Уд. расх. топл. на отп. ТЭ, кг/ГКал [Удельный Расход топлива на отпуск теплоэнергии при заданом Вээ, кг/ГКал]",
	CAST(dbo.vst_SafeDIV(SUM((G01_AM31Q701_H1_korr*G00_AF00W102/7/1000-MI_URT_OE*((L01_EB10P000_H1+L02_EB10P000_H1)-(L07_EB10P000_H1+L08_EB10P000_H1+L09_EB10P000_H1+L67_EB10P000_H1+L20_EB10P000_H1+L21_EB10P000_H1+L22_EB10P000_H1+L23_EB10P000_H1))/1000*0.001)),SUM(((ISNULL(U01_UN31W001_H1, 0)+U02_UN31W001_H1+U03_UN31W001_H1)/4.187) + ((U04_UM11W002_H1+U06_UM11W002_H1+U07_UM11W002_H1+U05_UM11W002_H1+ISNULL(U08_UM11W002_H1, 0))-(U04_UM21W002_H1+U06_UM21W002_H1+U06_UM22W002_H1+U07_UM21W002_H1+U05_UM21W002_H1+ISNULL(U08_UM21W002_H1, 0)))))*1000 as decimal(15,3))
		as "корр Уд. расх. топл. на отп. ТЭ, кг/ГКал [Удельный Расход топлива на отпуск теплоэнергии при заданом Вээ, кг/ГКал]",
	CAST(100*dbo.vst_SafeDIV((0.86*(sum((L01_EB10P000_H1+L02_EB10P000_H1)-(L07_EB10P000_H1+L08_EB10P000_H1+L09_EB10P000_H1+L67_EB10P000_H1+L20_EB10P000_H1+L21_EB10P000_H1+L22_EB10P000_H1+L23_EB10P000_H1))/1000)+(sum(U04_UM31W001_H1+U06_UM31W001_H1+U07_UM31W001_H1+U05_UM31W001_H1+ISNULL(U08_UM31W001_H1, 0)+ISNULL(U01_UN31W001_H1, 0)+U02_UN31W001_H1+U03_UN31W001_H1)/4.187)),((sum(G01_AM31Q701_H1_korr*G00_AF00W102)/7/1000)*7))
		as decimal(15,2)) as "КПД топливо<br>использования,% [КПД топливоиспользования ТЭЦ, %]",
	CAST(100*dbo.vst_SafeDIV((0.86*(sum((L01_EB10P000_H1+L02_EB10P000_H1)-(L07_EB10P000_H1+L08_EB10P000_H1+L09_EB10P000_H1+L67_EB10P000_H1+L20_EB10P000_H1+L21_EB10P000_H1+L22_EB10P000_H1+L23_EB10P000_H1))/1000)+(sum(((ISNULL(U01_UN31W001_H1, 0)+U02_UN31W001_H1+U03_UN31W001_H1)/4.187) + ((U04_UM11W002_H1+U06_UM11W002_H1+U07_UM11W002_H1+U05_UM11W002_H1+ISNULL(U08_UM11W002_H1, 0))-(U04_UM21W002_H1+U06_UM21W002_H1+U06_UM22W002_H1+U07_UM21W002_H1+U05_UM21W002_H1+ISNULL(U08_UM21W002_H1, 0))))
	)),((sum(G01_AM31Q701_H1_korr*G00_AF00W102)/7/1000)*7)) as decimal(15,2))
		as "корр<br>КПД_ТИ,<br>% [КПД топливоиспользования ТЭЦ, %]"
FROM (
	SELECT *,
		CASE WHEN DateTime >= '20211008 15:49:00' AND DateTime <= '20211026 10:00:00' THEN G01_AM31Q701_H1 / 1000 ELSE G01_AM31Q701_H1 END AS G01_AM31Q701_H1_korr
	FROM
		OpenQuery(INSQL,
		"SELECT DateTime, CLC_ShiftDuty,
		U04_UM11W002_H1, U06_UM11W002_H1, U07_UM11W002_H1, U05_UM11W002_H1, U04_UM21W002_H1, U06_UM21W002_H1, U06_UM22W002_H1, U07_UM21W002_H1,
		U05_UM21W002_H1, L01_EB10P000_H1, L02_EB10P000_H1, L07_EB10P000_H1, L08_EB10P000_H1, L09_EB10P000_H1, L67_EB10P000_H1, L20_EB10P000_H1,
		L21_EB10P000_H1, L22_EB10P000_H1, L23_EB10P000_H1, MI_URT_OE,
		U04_UM31W001_H1, U06_UM31W001_H1, U07_UM31W001_H1, U05_UM31W001_H1, U08_UM21W002_H1, U08_UM11W002_H1, U08_UM31W001_H1,
		U01_UN31W001_H1, U02_UN31W001_H1, U03_UN31W001_H1, G01_AM31Q701_H1, G00_AF00W102
		FROM Runtime.dbo.AnalogWideHistory
		WHERE wwVersion = 'Latest'
		AND wwRetrievalMode = 'Cyclic'
		AND wwResolution = @resolution
		AND DateTime >= @start
		AND DateTime <= @finish")
) AS T1
WHERE
	Runtime.dbo.vst_GetShiftNumber(DateTime) = 2
GROUP BY
	DateAdd(mi,480,Convert(DateTime,Round(Convert(float,DateAdd(mi,-500,DateTime))*2,0,1)/2))
Order By
	DateAdd(mi,480,Convert(DateTime,Round(Convert(float,DateAdd(mi,-500,DateTime))*2,0,1)/2))


{Смена Г за месяц}
/*ReportName="Показатели экономичности (эком)"(СМЕНА Г ЗА МЕСЯЦ)*/
/*Mode=смены за месяц*/
/*DownQuery="часовые срезы по сменам 8/12"*/
/*UpQuery="смены за месяц"*/

SET QUOTED_IDENTIFIER OFF
select
	--'02' + Right(Convert(char(10), MIN(DateTime), 104), 8) as 'DateMarker',
	DateAdd(mi, 480, Convert(DateTime, Round(Convert(float, DateAdd(mi, -500, DateTime))*  2, 0, 1) / 2)) as 'Дата',
	null,
	CHAR(192 + Runtime.dbo.vst_GetShiftNumber(MIN(DateTime)))
		as "Cмена",
	CAST(sum((L01_EB10P000_H1+L02_EB10P000_H1))/1000 as decimal(15,3))
		as "Выработка Эл/эн, тыс.кВт.ч. [(L01_EB10P000_H1+L02_EB10P000_H1)]",
	CAST(sum((L01_EB10P000_H1+L02_EB10P000_H1)-(L07_EB10P000_H1+L08_EB10P000_H1+L09_EB10P000_H1+L67_EB10P000_H1+L20_EB10P000_H1+L21_EB10P000_H1+L22_EB10P000_H1+L23_EB10P000_H1))/1000 as decimal(15,3))
		as "Отпуск Эл/эн, тыс.кВт.ч. [E01-(E19+E20+E21+E22+E23+E24+E25+E26)]",
	CAST(sum(U04_UM31W001_H1+U06_UM31W001_H1+U07_UM31W001_H1+U05_UM31W001_H1+ISNULL(U08_UM31W001_H1, 0)+ISNULL(U01_UN31W001_H1, 0)+U02_UN31W001_H1+U03_UN31W001_H1)/4.187 as decimal(15,3))
		as "Отпуск т/эн, ГКал [Отпуск теплоэнергии, ГКал]",
	CAST(sum(((ISNULL(U01_UN31W001_H1, 0)+U02_UN31W001_H1+U03_UN31W001_H1)/4.187) + ((U04_UM11W002_H1+U06_UM11W002_H1+U07_UM11W002_H1+U05_UM11W002_H1+ISNULL(U08_UM11W002_H1, 0))-(U04_UM21W002_H1+U06_UM21W002_H1+U06_UM22W002_H1+U07_UM21W002_H1+U05_UM21W002_H1+ISNULL(U08_UM21W002_H1, 0))))	as decimal(15,2)) 
		as "корр Отпуск т/эн, ГКал [Отпуск теплоэнергии, ГКал]",
	CAST(sum(U04_UM31W001_H1+U06_UM31W001_H1+U07_UM31W001_H1+U05_UM31W001_H1+ISNULL(U08_UM31W001_H1, 0))/4.187 as decimal(15,3))
		as "Отпуск т/эн водой, ГКал [Отпуск теплоэнергии по магистралям Центр+Док+запад+ВЗРД]",
	CAST(sum(((U04_UM11W002_H1+U06_UM11W002_H1+U07_UM11W002_H1+U05_UM11W002_H1+ISNULL(U08_UM11W002_H1, 0))-(U04_UM21W002_H1+U06_UM21W002_H1+U06_UM22W002_H1+U07_UM21W002_H1+U05_UM21W002_H1+ISNULL(U08_UM21W002_H1, 0)))) as decimal(15,2))
		as "корр Отпуск т/эн водой, ГКал [Отпуск теплоэнергии по магистралям Центр+Док+запад+ВЗРД]",
	CAST(sum(ISNULL(U01_UN31W001_H1, 0)+U02_UN31W001_H1+U03_UN31W001_H1)/4.187 as decimal(15,3))
		as "Отпуск т/эн паром, ГКал [Отпуск теплоэнергии по магистралям Док+КИМ+ВЗРД (пар)]",
	CAST(sum(G01_AM31Q701_H1_korr)/1000 as decimal(15,3))
		as "Расход газа, тыс. м3/ч [G01_AM31Q701_H1]",
	CAST(sum(G01_AM31Q701_H1_korr*G00_AF00W102)/7/1000 as decimal(15,3))
		as "Расход Усл. Топл, ТУТ [G01_AM31Q701_H1*G00_AF00W102/7]",
	CAST(avg(MI_URT_OE) as decimal(15,3))
		as "Уд. расх. топл. [MI_URT_OE]",
	CAST(avg(MI_URT_OE) * sum(((L01_EB10P000_H1+L02_EB10P000_H1) - (L07_EB10P000_H1+L08_EB10P000_H1+L09_EB10P000_H1+L67_EB10P000_H1+L20_EB10P000_H1+L21_EB10P000_H1+L22_EB10P000_H1+L23_EB10P000_H1))/ 1000)/1000 as decimal(15,3))
		as "Расх. топл. на отп. ЭЭ, ТУТ [Расход топлива на отпуск электроэнергии]",
	CAST(sum(G01_AM31Q701_H1_korr*G00_AF00W102)/7/1000-(avg(MI_URT_OE)*(sum((L01_EB10P000_H1+L02_EB10P000_H1)-(L07_EB10P000_H1+L08_EB10P000_H1+L09_EB10P000_H1+L67_EB10P000_H1+L20_EB10P000_H1+L21_EB10P000_H1+L22_EB10P000_H1+L23_EB10P000_H1))/1000)/1000)as decimal(15,3))
		as "Расх. топл. на отп. ТЭ, ТУТ [Расход топлива на отпуск теплоэнергии]",
	CAST(dbo.vst_SafeDIV((sum(G01_AM31Q701_H1_korr*G00_AF00W102)/7/1000-(avg(MI_URT_OE)*(sum((L01_EB10P000_H1+L02_EB10P000_H1)-(L07_EB10P000_H1+L08_EB10P000_H1+L09_EB10P000_H1+L67_EB10P000_H1+L20_EB10P000_H1+L21_EB10P000_H1+L22_EB10P000_H1+L23_EB10P000_H1))/1000)/1000)),(sum(U04_UM31W001_H1+U06_UM31W001_H1+U07_UM31W001_H1+U05_UM31W001_H1+ISNULL(U08_UM31W001_H1, 0)+ISNULL(U01_UN31W001_H1, 0)+U02_UN31W001_H1+U03_UN31W001_H1)/4.187))*1000 as decimal(15,3))
		as "Уд. расх. топл. на отп. ТЭ, кг/ГКал [Удельный Расход топлива на отпуск теплоэнергии при заданом Вээ, кг/ГКал]",
	CAST(dbo.vst_SafeDIV(SUM((G01_AM31Q701_H1_korr*G00_AF00W102/7/1000-MI_URT_OE*((L01_EB10P000_H1+L02_EB10P000_H1)-(L07_EB10P000_H1+L08_EB10P000_H1+L09_EB10P000_H1+L67_EB10P000_H1+L20_EB10P000_H1+L21_EB10P000_H1+L22_EB10P000_H1+L23_EB10P000_H1))/1000*0.001)),SUM(((ISNULL(U01_UN31W001_H1, 0)+U02_UN31W001_H1+U03_UN31W001_H1)/4.187) + ((U04_UM11W002_H1+U06_UM11W002_H1+U07_UM11W002_H1+U05_UM11W002_H1+ISNULL(U08_UM11W002_H1, 0))-(U04_UM21W002_H1+U06_UM21W002_H1+U06_UM22W002_H1+U07_UM21W002_H1+U05_UM21W002_H1+ISNULL(U08_UM21W002_H1, 0)))))*1000 as decimal(15,3))
		as "корр Уд. расх. топл. на отп. ТЭ, кг/ГКал [Удельный Расход топлива на отпуск теплоэнергии при заданом Вээ, кг/ГКал]",
	CAST(100*dbo.vst_SafeDIV((0.86*(sum((L01_EB10P000_H1+L02_EB10P000_H1)-(L07_EB10P000_H1+L08_EB10P000_H1+L09_EB10P000_H1+L67_EB10P000_H1+L20_EB10P000_H1+L21_EB10P000_H1+L22_EB10P000_H1+L23_EB10P000_H1))/1000)+(sum(U04_UM31W001_H1+U06_UM31W001_H1+U07_UM31W001_H1+U05_UM31W001_H1+ISNULL(U08_UM31W001_H1, 0)+ISNULL(U01_UN31W001_H1, 0)+U02_UN31W001_H1+U03_UN31W001_H1)/4.187)),((sum(G01_AM31Q701_H1_korr*G00_AF00W102)/7/1000)*7))
		as decimal(15,2)) as "КПД топливо<br>использования,% [КПД топливоиспользования ТЭЦ, %]",
	CAST(100*dbo.vst_SafeDIV((0.86*(sum((L01_EB10P000_H1+L02_EB10P000_H1)-(L07_EB10P000_H1+L08_EB10P000_H1+L09_EB10P000_H1+L67_EB10P000_H1+L20_EB10P000_H1+L21_EB10P000_H1+L22_EB10P000_H1+L23_EB10P000_H1))/1000)+(sum(((ISNULL(U01_UN31W001_H1, 0)+U02_UN31W001_H1+U03_UN31W001_H1)/4.187) + ((U04_UM11W002_H1+U06_UM11W002_H1+U07_UM11W002_H1+U05_UM11W002_H1+ISNULL(U08_UM11W002_H1, 0))-(U04_UM21W002_H1+U06_UM21W002_H1+U06_UM22W002_H1+U07_UM21W002_H1+U05_UM21W002_H1+ISNULL(U08_UM21W002_H1, 0))))
	)),((sum(G01_AM31Q701_H1_korr*G00_AF00W102)/7/1000)*7)) as decimal(15,2))
		as "корр<br>КПД_ТИ,<br>% [КПД топливоиспользования ТЭЦ, %]"
FROM (
	SELECT *,
		CASE WHEN DateTime >= '20211008 15:49:00' AND DateTime <= '20211026 10:00:00' THEN G01_AM31Q701_H1 / 1000 ELSE G01_AM31Q701_H1 END AS G01_AM31Q701_H1_korr
	FROM
		OpenQuery(INSQL,
		"SELECT DateTime, CLC_ShiftDuty,
		U04_UM11W002_H1, U06_UM11W002_H1, U07_UM11W002_H1, U05_UM11W002_H1, U04_UM21W002_H1, U06_UM21W002_H1, U06_UM22W002_H1, U07_UM21W002_H1,
		U05_UM21W002_H1, L01_EB10P000_H1, L02_EB10P000_H1, L07_EB10P000_H1, L08_EB10P000_H1, L09_EB10P000_H1, L67_EB10P000_H1, L20_EB10P000_H1,
		L21_EB10P000_H1, L22_EB10P000_H1, L23_EB10P000_H1, MI_URT_OE,
		U04_UM31W001_H1, U06_UM31W001_H1, U07_UM31W001_H1, U05_UM31W001_H1, U08_UM21W002_H1, U08_UM11W002_H1, U08_UM31W001_H1,
		U01_UN31W001_H1, U02_UN31W001_H1, U03_UN31W001_H1, G01_AM31Q701_H1, G00_AF00W102
		FROM Runtime.dbo.AnalogWideHistory
		WHERE wwVersion = 'Latest'
		AND wwRetrievalMode = 'Cyclic'
		AND wwResolution = @resolution
		AND DateTime >= @start
		AND DateTime <= @finish")
) AS T1
WHERE
	Runtime.dbo.vst_GetShiftNumber(DateTime) = 3
GROUP BY
	DateAdd(mi,480,Convert(DateTime,Round(Convert(float,DateAdd(mi,-500,DateTime))*2,0,1)/2))
Order By
	DateAdd(mi,480,Convert(DateTime,Round(Convert(float,DateAdd(mi,-500,DateTime))*2,0,1)/2))


{смены за месяц}
/*ReportName="Показатели экономичности (эком)" (агрегированные по сменам за месяц)*/
/*Mode=смены за месяц*/
/*DownQuery="посменный"*/
/*UpQuery="суточные срезы"*/

SET QUOTED_IDENTIFIER OFF
SET LANGUAGE 'Russian'
SELECT
	--'02'+Right(Convert(char(10),MIN(DateTime),104),8) as 'Дата',
	null,
	CHAR(192+Runtime.dbo.vst_GetShiftNumber(DateTime))
		as "Cмена [CLC_ShiftDuty]",
	Count(*)
		as "Час [Время, отработанное сменой за месяц, час]",
	CAST(sum((L01_EB10P000_H1+L02_EB10P000_H1))/1000 as decimal(15,3))
		as "Выработка Эл/эн, тыс.кВт.ч. [(L01_EB10P000_H1+L02_EB10P000_H1)]",
	CAST(sum((L01_EB10P000_H1+L02_EB10P000_H1)-(L07_EB10P000_H1+L08_EB10P000_H1+L09_EB10P000_H1+L67_EB10P000_H1+L20_EB10P000_H1+L21_EB10P000_H1+L22_EB10P000_H1+L23_EB10P000_H1))/1000 as decimal(15,3))
		as "Отпуск Эл/эн, тыс.кВт.ч. [E01-(E19+E20+E21+E22+E23+E24+E25+E26)]",
	CAST(sum(U04_UM31W001_H1+U06_UM31W001_H1+U07_UM31W001_H1+U05_UM31W001_H1+ISNULL(U01_UN31W001_H1, 0)+U02_UN31W001_H1+U03_UN31W001_H1)/4.187 as decimal(15,3))
		as "Отпуск т/эн, ГКал [Отпуск теплоэнергии, ГКал]",
	CAST(sum(((ISNULL(U01_UN31W001_H1, 0)+U02_UN31W001_H1+U03_UN31W001_H1)/4.187) + ((U04_UM11W002_H1+U06_UM11W002_H1+U07_UM11W002_H1+U05_UM11W002_H1)-(U04_UM21W002_H1+U06_UM21W002_H1+U06_UM22W002_H1+U07_UM21W002_H1+U05_UM21W002_H1))) as decimal(15,2))
		as "корр Отпуск т/эн, ГКал [Отпуск теплоэнергии, ГКал]",
	CAST(sum(U04_UM31W001_H1+U06_UM31W001_H1+U07_UM31W001_H1+U05_UM31W001_H1)/4.187 as decimal(15,3))
		as "Отпуск т/эн водой, ГКал [Отпуск теплоэнергии по магистралям Центр+Док+запад+ВЗРД]",
	CAST(sum(((U04_UM11W002_H1+U06_UM11W002_H1+U07_UM11W002_H1+U05_UM11W002_H1)-(U04_UM21W002_H1+U06_UM21W002_H1+U06_UM22W002_H1+U07_UM21W002_H1+U05_UM21W002_H1))) as decimal(15,2))
		as "корр Отпуск т/эн водой, ГКал [Отпуск теплоэнергии по магистралям Центр+Док+запад+ВЗРД]",
	CAST(sum(ISNULL(U01_UN31W001_H1, 0)+U02_UN31W001_H1+U03_UN31W001_H1)/4.187 as decimal(15,3))
		as "Отпуск т/эн паром, ГКал [Отпуск теплоэнергии по магистралям Док+КИМ+ВЗРД (пар)]",
	CAST(sum(G01_AM31Q701_H1_korr)/1000 as decimal(15,3))
		as "Расход газа, тыс. м3/ч [G01_AM31Q701_H1]",
	CAST(sum(G01_AM31Q701_H1_korr*G00_AF00W102)/7/1000 as decimal(15,3))
		as "Расход Усл. Топл, ТУТ [G01_AM31Q701_H1*G00_AF00W102/7]",
	CAST(avg(MI_URT_OE) as decimal(15,3))
		as "Уд. расх. топл. [MI_URT_OE]",
	CAST(avg(MI_URT_OE)*(sum((L01_EB10P000_H1+L02_EB10P000_H1)-(L07_EB10P000_H1+L08_EB10P000_H1+L09_EB10P000_H1+L67_EB10P000_H1+L20_EB10P000_H1+L21_EB10P000_H1+L22_EB10P000_H1+L23_EB10P000_H1))/1000)/1000 as decimal(15,3))
		as "Расх. топл. на отп. ЭЭ, ТУТ [Расход топлива на отпуск электроэнергии]",
	CAST(sum(G01_AM31Q701_H1_korr*G00_AF00W102)/7/1000-(avg(MI_URT_OE)*(sum((L01_EB10P000_H1+L02_EB10P000_H1)-(L07_EB10P000_H1+L08_EB10P000_H1+L09_EB10P000_H1+L67_EB10P000_H1+L20_EB10P000_H1+L21_EB10P000_H1+L22_EB10P000_H1+L23_EB10P000_H1))/1000)/1000) as decimal(15,3))
		as "Расх. топл. на отп. ТЭ, ТУТ [Расход топлива на отпуск теплоэнергии]",
	CAST(dbo.vst_SafeDIV((sum(G01_AM31Q701_H1_korr*G00_AF00W102)/7/1000-(avg(MI_URT_OE)*(sum((L01_EB10P000_H1+L02_EB10P000_H1)-(L07_EB10P000_H1+L08_EB10P000_H1+L09_EB10P000_H1+L67_EB10P000_H1+L20_EB10P000_H1+L21_EB10P000_H1+L22_EB10P000_H1+L23_EB10P000_H1))/1000)/1000)),(sum(U04_UM31W001_H1+U06_UM31W001_H1+U07_UM31W001_H1+U05_UM31W001_H1+ISNULL(U01_UN31W001_H1, 0)+U02_UN31W001_H1+U03_UN31W001_H1)/4.187))*1000 as decimal(15,3))
		as "Уд. расх. топл. на отп. ТЭ, кг/ГКал [Удельный Расход топлива на отпуск теплоэнергии при заданом Вээ, кг/ГКал]",
	CAST(dbo.vst_SafeDIV(SUM((G01_AM31Q701_H1_korr*G00_AF00W102/7/1000-MI_URT_OE*((L01_EB10P000_H1+L02_EB10P000_H1)-(L07_EB10P000_H1+L08_EB10P000_H1+L09_EB10P000_H1+L67_EB10P000_H1+L20_EB10P000_H1+L21_EB10P000_H1+L22_EB10P000_H1+L23_EB10P000_H1))/1000*0.001)),SUM(((ISNULL(U01_UN31W001_H1, 0)+U02_UN31W001_H1+U03_UN31W001_H1)/4.187) + ((U04_UM11W002_H1+U06_UM11W002_H1+U07_UM11W002_H1+U05_UM11W002_H1)-(U04_UM21W002_H1+U06_UM21W002_H1+U06_UM22W002_H1+U07_UM21W002_H1+U05_UM21W002_H1))))*1000 as decimal(15,3))
		as "корр Уд. расх. топл. на отп. ТЭ, кг/ГКал [Удельный Расход топлива на отпуск теплоэнергии при заданом Вээ, кг/ГКал]",
	CAST(100*dbo.vst_SafeDIV((0.86*(sum((L01_EB10P000_H1+L02_EB10P000_H1)-(L07_EB10P000_H1+L08_EB10P000_H1+L09_EB10P000_H1+L67_EB10P000_H1+L20_EB10P000_H1+L21_EB10P000_H1+L22_EB10P000_H1+L23_EB10P000_H1))/1000)+(sum(U04_UM31W001_H1+U06_UM31W001_H1+U07_UM31W001_H1+U05_UM31W001_H1+ISNULL(U01_UN31W001_H1, 0)+U02_UN31W001_H1+U03_UN31W001_H1)/4.187)),((sum(G01_AM31Q701_H1_korr*G00_AF00W102)/7/1000)*7))
	as decimal(15,2))
		as "КПД топливо<br>использования,% [КПД топливоиспользования ТЭЦ, %]",
	CAST(100*dbo.vst_SafeDIV((0.86*(sum((L01_EB10P000_H1+L02_EB10P000_H1)-(L07_EB10P000_H1+L08_EB10P000_H1+L09_EB10P000_H1+L67_EB10P000_H1+L20_EB10P000_H1+L21_EB10P000_H1+L22_EB10P000_H1+L23_EB10P000_H1))/1000)+(sum(((ISNULL(U01_UN31W001_H1, 0)+U02_UN31W001_H1+U03_UN31W001_H1)/4.187) + ((U04_UM11W002_H1+U06_UM11W002_H1+U07_UM11W002_H1+U05_UM11W002_H1)-(U04_UM21W002_H1+U06_UM21W002_H1+U06_UM22W002_H1+U07_UM21W002_H1+U05_UM21W002_H1))))),((sum(G01_AM31Q701_H1_korr*G00_AF00W102)/7/1000)*7)) as decimal(15,2))
		as "корр<br>КПД_ТИ,<br>% [КПД топливоиспользования ТЭЦ, %]"
FROM (
	SELECT *,
		CASE WHEN DateTime >= '20211008 15:49:00' AND DateTime <= '20211026 10:00:00' THEN G01_AM31Q701_H1 / 1000 ELSE G01_AM31Q701_H1 END AS G01_AM31Q701_H1_korr
	FROM
		OpenQuery(INSQL,
		"SELECT DateTime, CLC_ShiftDuty,
		U04_UM11W002_H1, U06_UM11W002_H1, U07_UM11W002_H1, U05_UM11W002_H1, U04_UM21W002_H1, U06_UM21W002_H1, U06_UM22W002_H1, U07_UM21W002_H1,
		U05_UM21W002_H1, L01_EB10P000_H1, L02_EB10P000_H1, L07_EB10P000_H1, L08_EB10P000_H1, L09_EB10P000_H1, L67_EB10P000_H1, L20_EB10P000_H1,
		L21_EB10P000_H1, L22_EB10P000_H1, L23_EB10P000_H1, MI_URT_OE,
		U04_UM31W001_H1, U06_UM31W001_H1, U07_UM31W001_H1, U05_UM31W001_H1, U08_UM21W002_H1, U08_UM11W002_H1, U08_UM31W001_H1,
		U01_UN31W001_H1, U02_UN31W001_H1, U03_UN31W001_H1, G01_AM31Q701_H1, G00_AF00W102
		FROM Runtime.dbo.AnalogWideHistory
		WHERE wwVersion = 'Latest'
		AND wwRetrievalMode = 'Cyclic'
		AND wwResolution = @resolution
		AND DateTime >= @start
		AND DateTime <= @finish")
) AS T1
GROUP BY
	CHAR(192+Runtime.dbo.vst_GetShiftNumber(DateTime))
ORDER BY
	CHAR(192+Runtime.dbo.vst_GetShiftNumber(DateTime))


{часовые срезы исходные}
/*ReportName="Показатели экономичности (эком)" (срезы на конец часа)*/
/*Mode=часовые-1*/
/*DownQuery="часовые срезы по сменам 8/12"*/
/*UpQuery="суточные срезы"*/

SET QUOTED_IDENTIFIER OFF
SELECT
	*
FROM 
	OpenQuery(INSQL,
	"SELECT DateTime, CLC_ShiftDuty,
	U04_UM11W002_H1, U06_UM11W002_H1, U07_UM11W002_H1, U05_UM11W002_H1, U04_UM21W002_H1, U06_UM21W002_H1, U06_UM22W002_H1, U07_UM21W002_H1, U05_UM21W002_H1,
	L01_EB10P000_H1, L02_EB10P000_H1, L07_EB10P000_H1, L08_EB10P000_H1, L09_EB10P000_H1, L67_EB10P000_H1, L20_EB10P000_H1, L21_EB10P000_H1, L22_EB10P000_H1, 
	U04_UM11W001_H1, U04_UM21W001_H1, U08_UM31W001_H1, U08_UM21W002_H1, U08_UM11W002_H1,
	L23_EB10P000_H1, MI_URT_OE, U04_UM31W001_H1, U06_UM31W001_H1, U07_UM31W001_H1, U05_UM31W001_H1, U01_UN31W001_H1, U02_UN31W001_H1, U03_UN31W001_H1,
	G01_AM31Q701_H1, G00_AF00W102
	FROM Runtime.dbo.AnalogWideHistory
	WHERE wwVersion = 'Latest'
	AND wwRetrievalMode = 'Cyclic'
	AND wwResolution = @resolution
	AND DateTime >= @start
	AND DateTime <= @finish")